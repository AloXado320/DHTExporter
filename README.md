
# DHTExporter

A single file python script that exports a DHT file to local HTML file, replicating the "Save Viewer" functionally that was originally in DHT.

## How it works

A DHT file is just a SQLite database, so the script parses it's contents to the ones that can be read by the Web Viewer (metadata and messages). Their contents should be similar to the ones generated by the DHT App when using the "Open Viewer" local site.

The Web Viewer is builtin in the script and it's used as a template, with slight modifications on how the contents are loaded to make them work locally so everything can be saved inside an HTML file.

## Motivation

Without going in much detail, I wanted to save a personal channel that was more active in 2024. While DHT did the job saving the chat database, I felt something was missing, since someone I remember used to save chats inside a local web file using this program as well.

After looking around on [why it was removed](https://github.com/chylex/Discord-History-Tracker/discussions/246), I decided to create this tool since there's seems to be people that still misses this functionally, and I agree that having a local (single) HTML file is quite convenient.

## How to use

Generates an local web viewer file from a database file.
```
python3 dhtexporter.py dht_database.dht
```

Saves the html file in a diferent directory, by default it uses the base directory.
```
python3 dhtexporter.py dht_database.dht --outdir dir
```

Amound of threads used for messages database, defaults to 4, necessary since longer chats take a while without it.
```
python3 dhtexporter.py dht_database.dht --threads 4
```

Save additional extra json files. These are embedded inside the HTML file, this use case is to compare them to the ones generated by the DHT App.
```
python3 dhtexporter.py dht_database.dht --dump-json
```

## TODO

I would like to extend the functionally of the viewer, especially on media context since CDN links can expire any time, so a way to preserve them would be nice, though obviously by default it will still generate an HTML file like in the original.

- Save emojis, stickers, chat profile pictures (each of them will have separate command arguments):
    - Use Base64 inside the template HTML file, though that would bloat the size of the file.
    - Use separate folders, though that would make the HTML file less portable.
- Make it work on this [New CSS](https://github.com/chylex/Discord-History-Tracker/pull/279) once it's done.
- Account for main media files, these has to be saved inside a folder, again as a separate command argument)
    -  DHT App stores media inside the same db files or in a separate "dht_downloads" database. These are also stored separately with the "Export All..." options inside the Downloads section.
    - An idea would be to separate media by server folder for convenience.
- Fix some edge cases if any, this script was only tested on the personal channel mentioned and a quick test database.
